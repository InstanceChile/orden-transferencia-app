<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plataforma de Abastecimiento - Instance</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app-layout">
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="logo-instance">
          <span class="instance-text">Inst<span class="instance-dot">a</span>nce</span>
        </div>
        <div class="platform-name">
          <span>Plataforma de</span>
          <strong>Abastecimiento</strong>
        </div>
      </div>
      
      <nav class="sidebar-nav">
        <div class="nav-section">
          <span class="nav-section-title">M√≥dulos</span>
          <button class="nav-item active" data-module="oc">
            <span class="nav-icon">üõí</span>
            <span class="nav-text">Orden de Compra</span>
            <span class="nav-badge">OC</span>
          </button>
          <button class="nav-item" data-module="ot">
            <span class="nav-icon">üì¶</span>
            <span class="nav-text">Orden de Transferencia</span>
            <span class="nav-badge">OT</span>
          </button>
        </div>
      </nav>
      
      <div class="sidebar-footer">
        <div class="connection-status" id="connectionStatus">
          <span class="status-dot"></span>
          <span class="status-text">Conectado</span>
        </div>
      </div>
    </aside>

    <!-- Main Content Area -->
    <div class="main-wrapper">
      <!-- Header -->
      <header class="header">
        <div class="header-content">
          <div class="header-title" id="headerTitle">
            <h1>üõí Orden de Compra</h1>
            <span class="header-subtitle">Gesti√≥n de √≥rdenes de compra y recepciones</span>
          </div>
          <div class="header-stats" id="headerStats">
            <div class="stat-pill">
              <span class="stat-label">Total</span>
              <span class="stat-value" id="statTotal">-</span>
            </div>
          </div>
        </div>
      </header>

      <!-- Main Content -->
      <main class="main-content">
        <!-- ============================================ -->
        <!-- M√ìDULO: ORDEN DE COMPRA -->
        <!-- ============================================ -->
        <div class="module-content active" id="module-oc">
          <!-- Navigation Tabs OC -->
          <nav class="tabs-nav">
            <button class="tab-btn active" data-tab="oc-carga">
              <span class="tab-icon">üìã</span>
              <span class="tab-text">OC</span>
              <span class="tab-badge">Carga</span>
            </button>
            <button class="tab-btn" data-tab="oc-recepcion">
              <span class="tab-icon">‚úÖ</span>
              <span class="tab-text">Recepci√≥n</span>
              <span class="tab-badge">OCR</span>
            </button>
          </nav>

          <!-- Tab Panels OC -->
          <div class="tab-panels">
            <!-- OC Carga Panel -->
            <div class="tab-panel active" id="panel-oc-carga">
              <div class="panel-header">
                <div class="panel-info">
                  <h2>üìã Carga de Orden de Compra</h2>
                  <p>Registra las √≥rdenes de compra emitidas a proveedores</p>
                </div>
                <button class="btn btn-secondary" onclick="downloadTemplate('OC_COMPRA')">
                  <span class="btn-icon">üì•</span>
                  Descargar Plantilla
                </button>
              </div>
              
              <div class="upload-section">
                <div class="upload-zone" id="dropzone-oc-carga" data-type="oc-carga">
                  <div class="upload-icon">üìÅ</div>
                  <h3>Arrastra tu archivo aqu√≠</h3>
                  <p>o haz clic para seleccionar</p>
                  <span class="upload-formats">Formatos: CSV, XLSX, XLS</span>
                  <input type="file" id="file-oc-carga" accept=".csv,.xlsx,.xls" hidden>
                </div>
                
                <div class="upload-info">
                  <h4>Campos requeridos:</h4>
                  <ul class="field-list">
                    <li><code>Oc</code> - N√∫mero de la orden de compra</li>
                    <li><code>Cod_Prod</code> - C√≥digo del producto (EAN)</li>
                    <li><code>Cantidad_Prod_Oc</code> - Cantidad ordenada</li>
                  </ul>
                  <h4>Campos opcionales:</h4>
                  <ul class="field-list optional">
                    <li><code>Id_Det_OC</code> - ID √∫nico (si no se env√≠a, se genera autom√°tico)</li>
                    <li><code>SKU</code> - SKU del producto</li>
                    <li><code>Producto</code> - Nombre del producto</li>
                    <li><code>Proveedor</code> - Nombre del proveedor (validado)</li>
                    <li><code>Bodega</code> - Bodega de destino</li>
                    <li><code>Precio_Prod_Oc</code> - Precio por unidad</li>
                    <li><code>Precio_Caja</code> - Precio por caja</li>
                    <li><code>Cantidad_Caja</code> - Cantidad de cajas</li>
                    <li><code>UXC</code> - Unidades por caja</li>
                    <li><code>Total</code> - Monto total</li>
                    <li><code>Fecha_Creacion</code> - Fecha de creaci√≥n</li>
                    <li><code>Fecha_Recepcion</code> - Fecha esperada de recepci√≥n</li>
                  </ul>
                  <h4>‚ö†Ô∏è Proveedores v√°lidos:</h4>
                  <ul class="field-list proveedores" id="lista-proveedores-oc">
                    <!-- Se carga din√°micamente desde el servidor -->
                  </ul>
                </div>
              </div>
            </div>

            <!-- OC Recepci√≥n Panel -->
            <div class="tab-panel" id="panel-oc-recepcion">
              <div class="panel-header">
                <div class="panel-info">
                  <h2>‚úÖ Recepci√≥n de Orden de Compra</h2>
                  <p>Registra la recepci√≥n de productos en bodega</p>
                </div>
                <button class="btn btn-secondary" onclick="downloadTemplate('OC_RECEPCION')">
                  <span class="btn-icon">üì•</span>
                  Descargar Plantilla
                </button>
              </div>

              <div class="filter-section">
                <label class="filter-label">
                  <span>Filtrar por OC pendiente:</span>
                  <select id="select-oc-recepcion" class="select-input">
                    <option value="">-- Todas las OC --</option>
                  </select>
                </label>
              </div>
              
              <div class="upload-section">
                <div class="upload-zone" id="dropzone-oc-recepcion" data-type="oc-recepcion">
                  <div class="upload-icon">üìÅ</div>
                  <h3>Arrastra tu archivo aqu√≠</h3>
                  <p>o haz clic para seleccionar</p>
                  <span class="upload-formats">Formatos: CSV, XLSX, XLS</span>
                  <input type="file" id="file-oc-recepcion" accept=".csv,.xlsx,.xls" hidden>
                </div>
                
                <div class="upload-info">
                  <h4>Campos requeridos:</h4>
                  <ul class="field-list">
                    <li><code>Oc</code> o <code>Or_Compra</code> - N√∫mero de la OC</li>
                    <li><code>PRODUCTO</code> o <code>Cod_Prod</code> - C√≥digo del producto (EAN)</li>
                    <li><code>ENTRADA</code> - Cantidad recibida</li>
                  </ul>
                  <h4>Campos opcionales:</h4>
                  <ul class="field-list optional">
                    <li><code>PRECIO</code> - Precio de recepci√≥n</li>
                  </ul>
                  <div class="clientes-info">
                    <h4>üí° Compatibilidad:</h4>
                    <p style="font-size: 0.8rem; color: var(--text-muted);">
                      Acepta el mismo formato de archivo que usas con n8n (Det_Rec1, Det_Rec2)
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ============================================ -->
        <!-- M√ìDULO: ORDEN DE TRANSFERENCIA -->
        <!-- ============================================ -->
        <div class="module-content" id="module-ot">
          <!-- Navigation Tabs OT -->
          <nav class="tabs-nav">
            <button class="tab-btn active" data-tab="ot">
              <span class="tab-icon">üìã</span>
              <span class="tab-text">OT</span>
              <span class="tab-badge">Solicitud</span>
            </button>
            <button class="tab-btn" data-tab="ota">
              <span class="tab-icon">üîß</span>
              <span class="tab-text">OTA</span>
              <span class="tab-badge">Preparaci√≥n</span>
            </button>
            <button class="tab-btn" data-tab="otadet">
              <span class="tab-icon">üìä</span>
              <span class="tab-text">OTADET</span>
              <span class="tab-badge">Detalle EAN</span>
            </button>
            <button class="tab-btn" data-tab="otf">
              <span class="tab-icon">‚úÖ</span>
              <span class="tab-text">OTF</span>
              <span class="tab-badge">Recepci√≥n</span>
            </button>
          </nav>

          <!-- Tab Panels OT -->
          <div class="tab-panels">
            <!-- OT Panel -->
            <div class="tab-panel active" id="panel-ot">
              <div class="panel-header">
                <div class="panel-info">
                  <h2>üìã Carga de OT (Solicitud)</h2>
                  <p>Registra las √≥rdenes de transferencia solicitadas por Abastecimiento</p>
                </div>
                <button class="btn btn-secondary" onclick="downloadTemplate('OT')">
                  <span class="btn-icon">üì•</span>
                  Descargar Plantilla
                </button>
              </div>
              
              <div class="upload-section">
                <div class="upload-zone" id="dropzone-ot" data-type="ot">
                  <div class="upload-icon">üìÅ</div>
                  <h3>Arrastra tu archivo aqu√≠</h3>
                  <p>o haz clic para seleccionar</p>
                  <span class="upload-formats">Formatos: CSV, XLSX, XLS</span>
                  <input type="file" id="file-ot" accept=".csv,.xlsx,.xls" hidden>
                </div>
                
                <div class="upload-info">
                  <h4>Campos requeridos:</h4>
                  <ul class="field-list">
                    <li><code>id_ot</code> - ID √∫nico de la orden</li>
                    <li><code>sku</code> - C√≥digo del producto</li>
                    <li><code>cantidad_solicitada</code> - Cantidad a transferir</li>
                  </ul>
                  <h4>Campos opcionales:</h4>
                  <ul class="field-list optional">
                    <li><code>mlc</code> - C√≥digo MercadoLibre</li>
                    <li><code>cliente</code> - Cliente asociado</li>
                    <li><code>fecha_solicitud</code> - Fecha de solicitud</li>
                    <li><code>fecha_transferencia_comprometida</code> - Fecha comprometida</li>
                  </ul>
                  
                  <div class="clientes-info">
                    <h4>Clientes v√°lidos:</h4>
                    <div class="clientes-tags" id="clientesTags"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- OTA Panel -->
            <div class="tab-panel" id="panel-ota">
              <div class="panel-header">
                <div class="panel-info">
                  <h2>üîß Carga de OTA (Preparaci√≥n)</h2>
                  <p>Registra la preparaci√≥n de √≥rdenes por Operaciones</p>
                </div>
                <button class="btn btn-secondary" onclick="downloadTemplate('OTA')">
                  <span class="btn-icon">üì•</span>
                  Descargar Plantilla
                </button>
              </div>

              <div class="filter-section">
                <label class="filter-label">
                  <span>Filtrar por OT pendiente:</span>
                  <select id="select-ot-ota" class="select-input">
                    <option value="">-- Todas las OT --</option>
                  </select>
                </label>
              </div>
              
              <div class="upload-section">
                <div class="upload-zone" id="dropzone-ota" data-type="ota">
                  <div class="upload-icon">üìÅ</div>
                  <h3>Arrastra tu archivo aqu√≠</h3>
                  <p>o haz clic para seleccionar</p>
                  <span class="upload-formats">Formatos: CSV, XLSX, XLS</span>
                  <input type="file" id="file-ota" accept=".csv,.xlsx,.xls" hidden>
                </div>
                
                <div class="upload-info">
                  <h4>Campos requeridos:</h4>
                  <ul class="field-list">
                    <li><code>id_ot</code> - ID de la orden</li>
                    <li><code>sku</code> - C√≥digo del producto</li>
                    <li><code>cantidad_preparada</code> - Cantidad preparada</li>
                  </ul>
                  <h4>Campos opcionales:</h4>
                  <ul class="field-list optional">
                    <li><code>fecha_preparacion</code> - Fecha de preparaci√≥n</li>
                  </ul>
                </div>
              </div>
            </div>

            <!-- OTADET Panel -->
            <div class="tab-panel" id="panel-otadet">
              <div class="panel-header">
                <div class="panel-info">
                  <h2>üìä Carga de OTADET (Detalle EAN)</h2>
                  <p>Registra el detalle por c√≥digo EAN de cada producto preparado</p>
                </div>
                <button class="btn btn-secondary" onclick="downloadTemplate('OTADET')">
                  <span class="btn-icon">üì•</span>
                  Descargar Plantilla
                </button>
              </div>

              <div class="filter-section">
                <label class="filter-label">
                  <span>Filtrar por OT pendiente:</span>
                  <select id="select-ot-otadet" class="select-input">
                    <option value="">-- Todas las OT --</option>
                  </select>
                </label>
              </div>
              
              <div class="upload-section">
                <div class="upload-zone" id="dropzone-otadet" data-type="otadet">
                  <div class="upload-icon">üìÅ</div>
                  <h3>Arrastra tu archivo aqu√≠</h3>
                  <p>o haz clic para seleccionar</p>
                  <span class="upload-formats">Formatos: CSV, XLSX, XLS</span>
                  <input type="file" id="file-otadet" accept=".csv,.xlsx,.xls" hidden>
                </div>
                
                <div class="upload-info">
                  <h4>Campos requeridos:</h4>
                  <ul class="field-list">
                    <li><code>id_ot</code> - ID de la orden</li>
                    <li><code>sku</code> - C√≥digo del producto</li>
                    <li><code>ean</code> - C√≥digo de barras EAN</li>
                    <li><code>cantidad_preparada_ean</code> - Cantidad por EAN</li>
                  </ul>
                </div>
              </div>
            </div>

            <!-- OTF Panel -->
            <div class="tab-panel" id="panel-otf">
              <div class="panel-header">
                <div class="panel-info">
                  <h2>‚úÖ Carga de OTF (Recepci√≥n)</h2>
                  <p>Registra la recepci√≥n final de √≥rdenes en destino</p>
                </div>
                <button class="btn btn-secondary" onclick="downloadTemplate('OTF')">
                  <span class="btn-icon">üì•</span>
                  Descargar Plantilla
                </button>
              </div>

              <div class="filter-section">
                <label class="filter-label">
                  <span>Filtrar por OT pendiente:</span>
                  <select id="select-ot-otf" class="select-input">
                    <option value="">-- Todas las OT --</option>
                  </select>
                </label>
              </div>
              
              <div class="upload-section">
                <div class="upload-zone" id="dropzone-otf" data-type="otf">
                  <div class="upload-icon">üìÅ</div>
                  <h3>Arrastra tu archivo aqu√≠</h3>
                  <p>o haz clic para seleccionar</p>
                  <span class="upload-formats">Formatos: CSV, XLSX, XLS</span>
                  <input type="file" id="file-otf" accept=".csv,.xlsx,.xls" hidden>
                </div>
                
                <div class="upload-info">
                  <h4>Campos requeridos:</h4>
                  <ul class="field-list">
                    <li><code>id_ot</code> - ID de la orden</li>
                    <li><code>sku</code> - C√≥digo del producto</li>
                    <li><code>cantidad_recepcionada</code> - Cantidad recibida</li>
                  </ul>
                  <h4>Campos opcionales:</h4>
                  <ul class="field-list optional">
                    <li><code>fecha_recepcion</code> - Fecha de recepci√≥n</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Results Modal -->
  <div class="modal" id="resultsModal">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modalTitle">Resultado de Carga</h3>
        <button class="modal-close" onclick="closeModal()">&times;</button>
      </div>
      <div class="modal-body" id="modalBody">
        <!-- Contenido din√°mico -->
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" onclick="closeModal()">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>Procesando archivo...</p>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
